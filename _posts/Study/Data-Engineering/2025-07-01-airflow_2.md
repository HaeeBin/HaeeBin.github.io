---
title: "Airflow ì„¤ì¹˜ë¶€í„° DAG í™•ì¸ê¹Œì§€ í•´ë³´ê¸°! (Airflow 3.0 ê¸°ì¤€)"
excerpt: "Airflow, data engineering"

categories:
  - Data-Engineering
tags: 
  - [Airflow, DAG, data-pipeline, ETL, ë°ì´í„°ì—”ì§€ë‹ˆì–´ë§]

toc: true
toc_sticky: true

date: 2025-07-02
last_modified_at: 2025-07-02
---

> Airflow ê³µì‹ ë¬¸ì„œì—ëŠ” Python 3.9 ì´ìƒ, ê·¸ë¦¬ê³  **pip ë˜ëŠ” uv**ë¥¼ í†µí•œ ì„¤ì¹˜ ë°©ì‹ì„ ê¶Œì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.
> ì´ ê¸€ì—ì„œëŠ” Docker ì—†ì´, `uv`ë¥¼ ì‚¬ìš©í•´ **ê°„ë‹¨í•˜ê³  ë¹ ë¥´ê²Œ Airflowë¥¼ ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•˜ëŠ” ë°©ë²•**ìœ¼ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

> âœ… ì°¸ê³ : Poetryë‚˜ pip-toolsë¡œë„ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ, AirflowëŠ” `constraints.txt`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ê³µì‹ì ìœ¼ë¡œëŠ” `pip` ë˜ëŠ” `uv` ë°©ì‹ë§Œ ì§€ì›ë©ë‹ˆë‹¤.

---

# ğŸ›  1. Airflow ì„¤ì¹˜í•´ë³´ê¸° 
## MacOS / Linux ë²„ì „
### Python ë²„ì „ í™•ì¸

```bash
python --version
```

### AIRFLOW_HOME ì„¤ì • (ì„ íƒ)

```bash
export AIRFLOW_HOME=~/my_airflow
```

### uv ì„¤ì¹˜
- uvëŠ” ë¹ ë¥´ê³  í˜„ëŒ€ì ì¸ Python í™˜ê²½/íŒ¨í‚¤ì§€ ê´€ë¦¬ ë„êµ¬

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```


```bash
uv --version
```

### Airflow ì„¤ì¹˜

```bash
# Airflow ë²„ì „ ì§€ì • (ì˜ˆ: 3.0.2)
AIRFLOW_VERSION=3.0.2

# í˜„ì¬ íŒŒì´ì¬ ë²„ì „ ì¶”ì¶œ (ì˜ˆ: 3.11)
PYTHON_VERSION="$(python -c 'import sys; print(f"{sys.version_info.major}.{sys.version_info.minor}")')"

# ì œì•½ ì¡°ê±´ íŒŒì¼ URL ì§€ì •
CONSTRAINT_URL="https://raw.githubusercontent.com/apache/airflow/constraints-${AIRFLOW_VERSION}/constraints-${PYTHON_VERSION}.txt"

# Airflow ì„¤ì¹˜
uv pip install "apache-airflow==${AIRFLOW_VERSION}" --constraint "${CONSTRAINT_URL}"
```

### Airflow Standalone ì‹¤í–‰
- Airflow 2.5 ì´ìƒë¶€í„°ëŠ” ëª¨ë“  êµ¬ì„±ìš”ì†Œ(Webserver, Scheduler ë“±)ë¥¼ í•œ ë²ˆì— ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” standalone ëª…ë ¹ì–´ê°€ ìƒê¹€

```bash
airflow standalone
```

ğŸ”¹ ì‹¤í–‰ ì‹œ ë‹¤ìŒ ì‘ì—…ì´ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë¨
  - DB ì´ˆê¸°í™”
  - ê´€ë¦¬ì ê³„ì • ìƒì„±
  - ì›¹ ì„œë²„, ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰

<br>

## Windows ë²„ì „ (with Docker)
- ê³µì‹ì ìœ¼ë¡œëŠ” Windowsë¥¼ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— `WSL ë˜ëŠ” Docker` í™˜ê²½ì—ì„œ ì§„í–‰í•´ì•¼ í•¨

### Docker ë° Docker Compose ì„¤ì¹˜ í™•ì¸
- Docker Desktop ì„¤ì¹˜ ì‹œ Docker Composeë„ í•¨ê»˜ ì„¤ì¹˜ë¨

```bash
# powershellì´ë‚˜ CMDì—ì„œ ì§„í–‰
docker -v
docker-compose -v
```

### ì‘ì—… í´ë” ìƒì„± ë° ì´ë™
- í´ë”ëª…ì„ ììœ ë¡­ê²Œ ì§€ì •í•´ì„œ ìƒì„±í•˜ê³  ì´ë™

```bash
# powershellì´ë‚˜ CMDì—ì„œ ì§„í–‰
mkdir airflow-docker
cd airflow-docker
```

### docker-compose.yaml íŒŒì¼ ë‹¤ìš´ë¡œë“œ
- ìœˆë„ìš°ì—ì„œ `curl` ëª…ë ¹ì–´ê°€ ì•ˆë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ê³µì‹ ì‚¬ì´íŠ¸ì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ìƒì„±í•œ í´ë”ì— ì €ì¥
- ë‚´ê°€ ë‹¤ìš´ë¡œë“œí•œ íŒŒì¼ : https://airflow.apache.org/docs/apache-airflow/3.0.2/docker-compose.yaml
  - ë§ˆìš°ìŠ¤ ìš°í´ë¦­ -> 'ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ë§í¬ ì €ì¥' -> docker-compose.yamlë¡œ ì €ì¥ 

### `.env`íŒŒì¼ ìƒì„±
- ë©”ëª¨ì¥ê°™ì€ í…ìŠ¤íŠ¸ í¸ì§‘ê¸°ë¡œ .envíŒŒì¼ì„ ìƒì„±í–ˆë˜ í´ë”ì— ë§Œë“¤ì–´ì„œ ì•„ë˜ ë‚´ìš© ì…ë ¥ 

```text
AIRFLOW_UID=50000
```

### í•„ìˆ˜ ë””ë ‰í† ë¦¬ ìƒì„±

```bash
# powershellì´ë‚˜ CMDì—ì„œ ì§„í–‰
mkdir dags,logs,plugins,config
```

### Airflow í™˜ê²½ ì´ˆê¸°í™”

```bash
# powershellì´ë‚˜ CMDì—ì„œ ì§„í–‰
docker-compose up airflow-init
```

### Airflow ì‹¤í–‰

```bash
# powershellì´ë‚˜ CMDì—ì„œ ì§„í–‰
docker-compose up # ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰

# ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰
docker-compose up -d
```

### ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
- ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ëª©ë¡ì´ ì¶œë ¥ë¨

```bash
docker ps
```

## Web UI ì ‘ì†
- ì ‘ì† ì£¼ì†Œ: `http://localhost:8080`
ğŸ”¹ ë¡œê·¸ì¸ í™”ë©´
![Airflow login](/assets/images/posts_img/data_engineering_posts/airflow_login.PNG)

- ê¸°ë³¸ ë¡œê·¸ì¸
  - ID: airflow
  - PW: airflow

ğŸ”¹ ë¡œê·¸ì¸ í›„ ë©”ì¸ í™”ë©´
![Airflow main](/assets/images/posts_img/data_engineering_posts/airflow_main.PNG)

<br>

# ğŸ” 2. Airflow ê¸°ë³¸ ì„¤ì •
ğŸ”¹ ì˜ˆì œ DAG ìˆ¨ê¸°ê¸°
  - Airflow Web UIì—ì„œ DAG ëª©ë¡ì„ ë³´ë©´ ë‚´ê°€ ìƒì„±í•˜ì§€ ì•Šì•˜ë˜ ì˜ˆì œ DAGë“¤ë„ ì¡´ì¬
  - ì˜ˆì œ DAGë¥¼ ì•ˆë³´ì´ê²Œ í•˜ê³  ì‹¶ì„ ë•ŒëŠ” í´ë”ì— ìˆëŠ” docker-compose.yamlì—ì„œ ì•„ë˜ ì˜µì…˜ì„ ì¶”ê°€í•˜ê±°ë‚˜ trueë¡œ ë˜ì–´ìˆë˜ ê²ƒì„ falseë¡œ ë³€ê²½
    - `AIRFLOW__CORE__LOAD_EXAMPLES: 'false'`
  <br>
  - MacOS/Linuxì˜ ê²½ìš° `airflow.cfg` íŒŒì¼ì´ ìˆì„í…ë° ê·¸ íŒŒì¼ì„ ì—´ì–´ì„œ **load_examples**ë¥¼ Falseë¡œ ì„¤ì •í•˜ë©´ ë¨
    - `load_examples = False`

<br>

ğŸ”¹ DAG í´ë” ìˆ˜ì •í•˜ê¸°
  - MacOS/Linuxì˜ ê²½ìš° `airflow.cfg` íŒŒì¼ì— `dags_folder`ë³€ìˆ˜ê°€ ìˆìŒ
    - ë‚´ê°€ ì›í•˜ëŠ” ê²½ë¡œë¡œ ì§€ì •í•´ì£¼ê³ , ê·¸ í´ë” ê²½ë¡œì— dag íŒŒì¼ë“¤ì„ ë„£ìœ¼ë©´ ë¨.
    - ex) `dags_folder = /Users/user/airflow/dags`

<br>

ğŸ”¹ ì„¤ì • ë°˜ì˜ (Docker)

```bash
docker compose down -v  # ë³¼ë¥¨ê¹Œì§€ ì´ˆê¸°í™” (ì˜ˆì œ DAG ì œê±°)
docker compose up -d
```

<br>

ğŸ”¹ **ë¡œê·¸ê°€ ë³´ì´ì§€ ì•ŠëŠ” ì˜¤ë¥˜ í•´ê²° (Airflow 3.0 ì´ìƒ)**
  - Airflow Web UIì—ì„œ DAGì„ ì‹¤í–‰í•œ ë’¤ Taskë¥¼ í´ë¦­í–ˆì„ ë•Œ ë¡œê·¸ê°€ ì•„ë˜ì²˜ëŸ¼ ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ.

  ```
  Could not read served logs: Invalid URL 'http://:8793/...': No host supplied
  ```

  - ì´ëŠ” Airflowê°€ ë¡œê·¸ë¥¼ ì›¹ì—ì„œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ URLì„ ìƒì„±í•  ë•Œ, í˜¸ìŠ¤íŠ¸ ì •ë³´ê°€ ëˆ„ë½ë˜ì–´ ì˜ëª»ëœ URLì„ ìƒì„±í•˜ê¸° ë•Œë¬¸

  > Airflow 3.0ë¶€í„°ëŠ” ë¡œê·¸ URL ìƒì„±ì„ ìœ„í•œ `AIRFLOW__LOGGING__HOSTNAME_CALLABLE` í™˜ê²½ë³€ìˆ˜ë¥¼ ì§ì ‘ ì§€ì •í•´ì¤˜ì•¼ í•¨

  âœ… í•´ê²° ë°©ë²•

  ğŸ‘‰ ë¡œì»¬(macOS / Linux) í™˜ê²½
    - `export AIRFLOW__LOGGING__HOSTNAME_CALLABLE=socket:gethostname`
  
  ğŸ‘‰ Windows PowerShell í™˜ê²½
    - `$env:AIRFLOW__LOGGING__HOSTNAME_CALLABLE = "socket:gethostname"`
  
  ğŸ‘‰ Docker Compose í™˜ê²½
    - `docker-compose.yml` íŒŒì¼ì˜ `airflow-webserver` ì„œë¹„ìŠ¤ì— ì•„ë˜ í•­ëª©ì„ ì¶”ê°€
    
    ```yaml
    services:
      airflow-webserver:
        environment:
          - AIRFLOW__LOGGING__HOSTNAME_CALLABLE: socket:gethostname
    ```

ğŸ”„ ì„¤ì • í›„ì—ëŠ” compose downê³¼ upìœ¼ë¡œ Airflowë¥¼ ì¬ì‹œì‘í•´ì•¼ ë³€ê²½ ë‚´ìš©ì´ ë°˜ì˜

<br>

# ğŸ“ 3. DAG ìƒì„± í›„ ì‹¤í–‰í•˜ê¸°
## ğŸ§± DAG íŒŒì¼ ë§Œë“¤ê¸°
- AirflowëŠ” `dags_folder`ì— ìˆëŠ” `.py` íŒŒì¼ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ DAGìœ¼ë¡œ ë“±ë¡
  - ì•ì˜ ë‚´ìš©ìœ¼ë¡œ ì„¤ì¹˜ë¥¼ í–ˆë˜ Windows ì‚¬ìš©ìë“¤ì€ `dags`í´ë”ì— ìˆëŠ” `.py`íŒŒì¼ì„ ìë™ìœ¼ë¡œ ê°ì§€

<br>

1. ì„¤ì •í•œ dags ë””ë ‰í† ë¦¬ë¡œ ì´ë™
2. ì•„ë˜ì™€ ê°™ì€ `example_dag.py`íŒŒì¼ì„ í•˜ë‚˜ ìƒì„±í•˜ê¸°

```python
from airflow import DAG
from airflow.operators.bash import BashOperator
from datetime import datetime

# DAG ì •ì˜
with DAG(
    dag_id="example_dag",  #dag id ì„¤ì •. ê°™ì€ idì˜ dagê°€ ìˆìœ¼ë©´ ì•ˆë¨
    start_date=datetime(2025, 7, 1),  # ì‹œì‘ ë‚ ì§œ ì„¤ì •
    schedule="@once",  # ìˆ˜ë™ ë˜ëŠ” ìµœì´ˆ í•œ ë²ˆë§Œ ì‹¤í–‰
    catchup=False,  # start_dateë¶€í„° í˜„ì¬ê¹Œì§€ ê³¼ê±° ë‚ ì§œë¥¼ í•œêº¼ë²ˆì— ì‹¤í–‰í• ì§€ ì—¬ë¶€. Falseë©´ ì§€ê¸ˆ ì‹œì  ì´í›„ë§Œ ì‹¤í–‰
    description="ê°„ë‹¨í•œ DAG ì˜ˆì œ"
) as dag:

    task1 = BashOperator(
        task_id="start_task",
        bash_command="echo 'ğŸš€ Start task running!'"
    )

    task2 = BashOperator(
        task_id="end_task",
        bash_command="echo 'âœ… End task finished!'"
    )

    # ì˜ì¡´ì„± ì„¤ì •: task1ì´ ë¨¼ì €, task2ê°€ ê·¸ë‹¤ìŒ
    task1 >> task2
```

ğŸ”¹ dag ìƒì„± í›„ Web UI

![Airflow dag main](/assets/images/posts_img/data_engineering_posts/airflow_dag_made.PNG)


## ğŸš€ DAG íŒŒì¼ ì‹¤í–‰í•˜ê¸°
1ï¸âƒ£ DAG ëª©ë¡ì—ì„œ ì‹¤í–‰í•  DAG ì°¾ê¸°
  - ì‹¤í–‰í•˜ê³  ì‹¶ì€ DAGë¥¼ ëª©ë¡ì—ì„œ ì°¾ê¸°
  - ì˜¤ë¥¸ìª½ í† ê¸€ ë²„íŠ¼ í´ë¦­í•´ì„œ DAGì„ í™œì„±í™”(ON) í•´ì•¼ ì‹¤í–‰ ê°€ëŠ¥
<br>
2ï¸âƒ£ DAG ì‹¤í–‰ (Trigger)
- DAG ì´ë¦„ í´ë¦­ â†’ DAG ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™

![Airflow dag detail](/assets/images/posts_img/data_engineering_posts/dag_detail.PNG)

- ìƒë‹¨ ìš°ì¸¡ ğŸ’¥ Trigger ë²„íŠ¼ í´ë¦­

> â€» Airflow 3.0ì—ì„œëŠ” â–¶ ì•„ì´ì½˜ ëŒ€ì‹  Trigger ë²„íŠ¼ì´ ëª…ì‹œì ìœ¼ë¡œ í‘œì‹œë¨

<br>
3ï¸âƒ£ ì‹¤í–‰ ìƒíƒœ í™•ì¸
- Grid View (ê¸°ì¡´ Tree View)
  â†’ DAG ì‹¤í–‰ ì´ë ¥ê³¼ Task ìƒíƒœ í™•ì¸ ê°€ëŠ¥ <br>
  â†’ ì´ˆë¡ìƒ‰ì´ë©´ ì„±ê³µ, ë¹¨ê°„ìƒ‰ì€ ì‹¤íŒ¨, íšŒìƒ‰ì€ ë¯¸ì‹¤í–‰

![Airflow grid](/assets/images/posts_img/data_engineering_posts/airflow_success.PNG)

- Graph View
  â†’ Task ê°„ ì—°ê²° êµ¬ì¡°ë¥¼ ì‹œê°ì ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥ <br>

![Airflow graph](/assets/images/posts_img/data_engineering_posts/dag_gridview.PNG)

<br>
4ï¸âƒ£ ğŸ§¾ Task ë¡œê·¸ í™•ì¸
- Grid ë˜ëŠ” Graphì—ì„œ Task ì•„ì´ì½˜ í´ë¦­ â†’ ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” ì—´ë¦¼ -> "Task Instances" íƒ­ìœ¼ë¡œ ì´ë™
- â€œLogsâ€ ë²„íŠ¼ í´ë¦­
- BashOperatorì¼ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì€ ë¡œê·¸ê°€ í‘œì‹œë¨:

  ```bash
  Log message source details: sources=["/opt/airflow/logs/dag_id=example_dag/run_id=manual__2025-07-03T05:45:24.483154+00:00/task_id=start_task/attempt=1.log"]
  ...
  [2025-07-03, 14:45:25] INFO - ğŸš€ Start task running!:
  ...
  ```




